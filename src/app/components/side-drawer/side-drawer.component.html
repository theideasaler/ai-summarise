<!-- Mobile Backdrop -->
<div class="mobile-backdrop" 
     *ngIf="isMobileDrawerOpen$ | async" 
     (click)="closeMobileDrawer()">
</div>

<div class="side-drawer" [class.open]="shouldShowOpenClass$ | async" [class.collapsed]="shouldShowCollapsedClass$ | async">
  <!-- Logo Section -->
  <div class="drawer-header">
    <div class="logo-section" routerLink="/">
      <span class="logo-text">AI Summarise</span>
    </div>
    <div class="header-controls">
      <button class="collapse-btn" (click)="toggleDesktopCollapse()"
        title="{{ (isDesktopDrawerCollapsed$ | async) ? 'Expand Sidebar' : 'Collapse Sidebar' }}">
        <mat-icon>{{ (isDesktopDrawerCollapsed$ | async) ? 'keyboard_arrow_right' : 'keyboard_arrow_left' }}</mat-icon>
      </button>
      <button class="close-btn" (click)="closeMobileDrawer()" title="Close Menu">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Navigation Section -->
  <div class="drawer-content">
    <div class="nav-section">
      <nav class="nav-list">
        <!-- Main Navigation Items -->
        <a *ngFor="let item of navigationItems" [routerLink]="item.route" class="nav-item"
          [class.active]="isActive(item.route)"
          [title]="(isDesktopDrawerCollapsed$ | async) ? item.label + ' - ' + item.description : ''">
          <div class="nav-item-content">
            <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
            <div class="nav-text" *ngIf="shouldShowText$ | async">
              <span class="nav-label">{{ item.label }}</span>
              <span class="nav-description">{{ item.description }}</span>
            </div>
          </div>
        </a>
        
        <!-- Account Item -->
        <a routerLink="/account" class="nav-item account-item"
          [class.active]="isActive('/account')"
          [title]="(isDesktopDrawerCollapsed$ | async) ? 'Account - Manage subscription and settings' : ''">
          <div class="nav-item-content">
            <mat-icon class="nav-icon">account_circle</mat-icon>
            <div class="nav-text" *ngIf="shouldShowText$ | async">
              <span class="nav-label">Account</span>
              <span class="nav-description token-count" *ngIf="(remainingTokens$ | async) !== null && (remainingTokens$ | async) !== undefined">
                {{ (remainingTokens$ | async) | number }} remaining
              </span>
              <span class="nav-description" *ngIf="(remainingTokens$ | async) === null || (remainingTokens$ | async) === undefined">
                <ng-container *ngIf="currentUser$ | async; else notAuthenticated">
                  Loading...
                </ng-container>
                <ng-template #notAuthenticated>
                  Sign in to view
                </ng-template>
              </span>
            </div>
          </div>
        </a>
      </nav>
    </div>
  </div>

  <!-- User Section -->
  <div class="drawer-footer">
    <div *ngIf="currentUser$ | async as user" class="user-section">
      <div class="user-info">
        <app-user-avatar [user]="user" size="medium"></app-user-avatar>
        <div class="user-details" *ngIf="shouldShowText$ | async">
          <span class="user-name">{{ user.displayName || user.email }}</span>
          <span class="user-plan" *ngIf="subscriptionStatus$ | async as status; else defaultPlan">
            {{ getPlanDisplayName(status.tier) }}
          </span>
          <ng-template #defaultPlan>
            <span class="user-plan">
              <ng-container *ngIf="userProfile$ | async as profile; else checkingPlan">
                {{ getPlanDisplayName(profile.subscriptionTier) }}
              </ng-container>
              <ng-template #checkingPlan>
                Checking plan...
              </ng-template>
            </span>
          </ng-template>
        </div>
      </div>
      <button class="sign-out-btn" (click)="signOut()" [title]="(isDesktopDrawerCollapsed$ | async) ? 'Sign Out' : 'Sign Out'">
        <mat-icon matTooltip="Sign Out" matTooltipClass="consistent-tooltip">logout</mat-icon>
      </button>
    </div>
  </div>
</div>
