<div class="youtube-container no-form-field-bottom-space">
  <!-- Marketing Hero Section (when no summary exists) -->
  <div class="marketing-hero" *ngIf="!summaryResult() && !isLoadingSummary()">
    <div class="hero-content">
      <h1 class="hero-title">Transform YouTube Videos into Actionable Insights</h1>
      <p class="hero-subtitle">Get instant AI-powered summaries and intelligent rewrites of any YouTube video. Save
        hours of watching time and extract key information in seconds.</p>
      <div class="hero-features">
        <div class="feature-item">
          <mat-icon>flash_on</mat-icon>
          <span>Lightning-fast summaries</span>
        </div>
        <div class="feature-item">
          <mat-icon>edit</mat-icon>
          <span>Smart content rewriting</span>
        </div>
        <div class="feature-item">
          <mat-icon>tune</mat-icon>
          <span>Customizable fine-tuning</span>
        </div>
      </div>
    </div>
  </div>

  <div class="top-space"></div>
  <!-- Summary Result Component -->
  <app-summary-result *ngIf="summaryResult() || isLoadingSummary()" [summaryData]="summaryResult()"
    [isRegenerating]="isRegenerating()" [isLoading]="isLoadingSummary()" (regenerate)="onRegenerateSummary()"
    (clear)="onClearSummary()" (copy)="copySummary()">
  </app-summary-result>

  <!-- Rewrite Fine-Tuning Component -->
  <div class="rewrite-fine-tuning-container no-form-field-bottom-space" *ngIf="summaryResult() && !isLoadingSummary()">
    <app-rewrite-fine-tuning [isExpanded]="isRewriteFineTuningExpanded()" [tokenCount]="calculateSummaryTokens()"
      (expandedChange)="onRewriteFineTuningExpandedChange($event)" (rewriteSubmit)="onRewriteFineTuningSubmit($event)"
      (customPromptSaved)="onCustomPromptSaved($event)">
    </app-rewrite-fine-tuning>
  </div>
  <!-- Rewritten Summary Component -->
  <app-rewritten-summary *ngIf="rewrittenSummary() || isRewriteLoading()" [rewrittenData]="getRewrittenSummaryData()"
    [isRewriting]="isRegeneratingRewrite()" [isLoading]="isRewriteLoading() && !rewrittenSummary()"
    (rewriteAgain)="onRewriteAgain()" (clear)="onClearRewrittenSummary()" (copy)="copyRewrittenSummary()">
  </app-rewritten-summary>

  <!-- Multiline Input Component (for video fine-tuning) -->
  <app-multiline-input *ngIf="showFineTuningInput()" (inputSubmit)="onFineTuningSubmit($event)"
    (inputCancel)="onFineTuningCancel()">
  </app-multiline-input>
  <div class="bottom-space" [style.height.px]="bottomSpaceHeight()"></div>

  <!-- Hidden Video Preview for Duration Detection -->
  <div class="hidden-video" *ngIf="!inputControl.invalid && !tokenCountError() && !videoDuration()">
    <app-youtube-video-preview [url]="inputControl.value || ''" (duration)="onDuration($event)"
      (error)="onVideoError($event)">
    </app-youtube-video-preview>
  </div>

  <!-- Fixed Bottom Section -->
  <div class="fixed-bottom-section">
    <!-- Input Card (always at bottom) -->
    <div class="input-card" #inputCard>
      <!-- Fine-tuning Card (appears above input when toggled) -->
      <div class="settings-card"
        *ngIf="isFineTuningExpanded() && !inputControl.invalid && videoDuration() && videoDuration()! > 0" [@slideInOut]>
        <div class="card-header">
          <mat-icon class="card-icon">tune</mat-icon>
          <h3 class="card-title">Fine Tuning</h3>
        </div>
        <app-youtube-fine-tuning [videoDuration]="videoDuration()" [isExpanded]="isFineTuningExpanded()"
          [initialConfig]="fineTuningConfig()" (configChange)="onFineTuningConfigChange($event)">
        </app-youtube-fine-tuning>
      </div>

      <div class="card-header">
        <div class="header-left">
          <mat-icon class="card-icon">play_circle</mat-icon>
          <h3 class="card-title">Video Input</h3>
        </div>
        <div class="header-right">
          <!-- Token Badge -->
          <div *ngIf="isValidUrl()" [class.loading]="isLoadingTokens()">
            <!-- Show loading dots when loading tokens -->
            <ng-container *ngIf="isLoadingTokens()">
              <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </ng-container>

            <!-- Show token count when we have duration and tokens -->
            <ng-container *ngIf="!isLoadingTokens() && videoDuration() && videoDuration()! > 0 && tokenCount()">
              <div class="token-badge" (click)="tooltipRewrite.toggle()">
                <span class="token-count">{{ tokenCount() | number }} tokens</span>
                <mat-icon class="info-icon" #tooltipRewrite="matTooltip"
                  [matTooltip]="'This is an estimated token count for processing your video. Actual token usage may vary depending on content complexity and processing requirements. This estimate is provided for reference purposes only.'">info</mat-icon>
              </div>
            </ng-container>
            <!-- Show token counting error if any -->
            <ng-container *ngIf="!isLoadingTokens() && tokenCountError()">
              <div class="token-error" [matTooltip]="tokenCountError()">
                <mat-icon class="error-icon">warning</mat-icon>
                <span class="error-text">Token estimation unavailable</span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>

      <div class="input-container">
        <mat-form-field appearance="outline" class="input-field">
          <mat-label>YouTube URL</mat-label>
          <input matInput [formControl]="inputControl" placeholder="https://www.youtube.com/watch?v=jNQXAC9IVRw">
          <mat-icon matSuffix *ngIf="isLoadingVideo() && inputControl.valid"
            class="loading-icon">hourglass_empty</mat-icon>
          <mat-icon matSuffix *ngIf="isValidUrl() && !isLoadingVideo()" class="success-icon">check_circle</mat-icon>
          <mat-error *ngIf="inputControl.invalid && inputControl.touched">
            {{ errorMessage() }}
          </mat-error>
        </mat-form-field>
        <div class="action-buttons">
          <button mat-fab color="primary" class="submit-button" (click)="onSubmit()"
            [disabled]="inputControl.invalid || !videoDuration() || videoDuration()! <= 0 || isSubmitting()"
            matTooltip="Summarise" matTooltipClass="consistent-tooltip">
            <mat-icon *ngIf="!isSubmitting()">north</mat-icon>
            <mat-icon *ngIf="isSubmitting()" class="loading-icon">hourglass_empty</mat-icon>
          </button>
          <div class="tune-button-container">
            <button mat-fab class="tune-button" (click)="toggleFineTuning()"
              [disabled]="inputControl.invalid || !videoDuration() || videoDuration()! <= 0"
              [class.active]="isFineTuningExpanded()" matTooltip="Fine Tuning" matTooltipClass="consistent-tooltip">
              <mat-icon>tune</mat-icon>
            </button>
            <div class="red-dot-badge" *ngIf="hasCustomFineTuningConfig()" (click)="toggleFineTuning()"></div>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage150()" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ errorMessage150() }}</span>
      </div>
      <!-- Submit Error Message -->
      <div *ngIf="submitError()" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ submitError() }}</span>
      </div>
    </div>

  </div>
</div>