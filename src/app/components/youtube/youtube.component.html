<div class="youtube-container no-form-field-bottom-space">
  <!-- Hidden Video Preview for Duration Detection -->
  <div class="hidden-video" *ngIf="!inputControl.invalid">
    <app-youtube-video-preview [url]="inputControl.value || ''" (duration)="onDuration($event)"
      (error)="onVideoError($event)">
    </app-youtube-video-preview>
  </div>
  
  <!-- Marketing Hero Section (when no summary exists) -->
  <div class="marketing-hero" *ngIf="!summaryResult() && !isLoadingSummary()">
    <div class="hero-content">
      <h1 class="hero-title">Transform YouTube Videos into Actionable Insights</h1>
      <p class="hero-subtitle">Get instant AI-powered summaries and intelligent rewrites of any YouTube video. Save hours of watching time and extract key information in seconds.</p>
      <div class="hero-features">
        <div class="feature-item">
          <mat-icon>flash_on</mat-icon>
          <span>Lightning-fast summaries</span>
        </div>
        <div class="feature-item">
          <mat-icon>edit</mat-icon>
          <span>Smart content rewriting</span>
        </div>
        <div class="feature-item">
          <mat-icon>tune</mat-icon>
          <span>Customizable fine-tuning</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Result Component -->
  <app-summary-result *ngIf="summaryResult() || isLoadingSummary()" [summaryData]="summaryResult()"
    [isRegenerating]="isRegenerating()" [isLoading]="isLoadingSummary()" (regenerate)="onRegenerateSummary()"
    (clear)="onClearSummary()" (copy)="copySummary()">
  </app-summary-result>
  
  <!-- Rewrite Card -->
  <div class="rewrite-card-container" *ngIf="summaryResult() && !isLoadingSummary()">
    <div class="rewrite-card">
      <mat-icon class="rewrite-icon">edit</mat-icon>
      <span class="rewrite-text">Rewrite</span>
      <div class="token-badge-summary">
        <span class="token-count">{{ calculateSummaryTokens() | number}} tokens</span>
        <mat-icon class="info-icon" matTooltip="Estimated tokens based on summary length">info</mat-icon>
      </div>
      <div class="spacer"></div>
      <button mat-icon-button class="send-button" (click)="onRewriteSummary()" matTooltip="Rewrite summary">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fff">
          <path
            d="m176-120-56-56 301-302-181-45 198-123-17-234 179 151 216-88-87 217 151 178-234-16-124 198-45-181-301 301Zm24-520-80-80 80-80 80 80-80 80Zm355 197 48-79 93 7-60-71 35-86-86 35-71-59 7 92-79 49 90 22 23 90Zm165 323-80-80 80-80 80 80-80 80ZM569-570Z" />
        </svg>
      </button>
      <button mat-icon-button class="fine-tuning-button" (click)="onFineTuningSummary()" matTooltip="Fine Tuning">
        <mat-icon>tune</mat-icon>
      </button>
    </div>
  </div>
  
  <!-- Multiline Input Component -->
  <app-multiline-input *ngIf="showFineTuningInput()" (inputSubmit)="onFineTuningSubmit($event)"
    (inputCancel)="onFineTuningCancel()">
  </app-multiline-input>
  <!-- Fixed Bottom Section -->
  <div class="fixed-bottom-section" [class.drawer-collapsed]="isDesktopDrawerCollapsed$ | async">
  
    <!-- Fine-tuning Card (appears above input when toggled) -->
    <div class="settings-card"
      *ngIf="isFineTuningExpanded() && !inputControl.invalid && videoDuration() && videoDuration()! > 0" [@slideInOut]>
      <div class="card-header">
        <mat-icon class="card-icon">tune</mat-icon>
        <h3 class="card-title">Fine Tuning</h3>
      </div>
      <app-youtube-fine-tuning [videoDuration]="videoDuration()" [isExpanded]="isFineTuningExpanded()"
        [initialConfig]="fineTuningConfig()" (configChange)="onFineTuningConfigChange($event)">
      </app-youtube-fine-tuning>
    </div>
  
    <!-- Input Card (always at bottom) -->
    <div class="input-card">
      <div class="card-header">
        <div class="header-left">
          <mat-icon class="card-icon">play_circle</mat-icon>
          <h3 class="card-title">Video Input</h3>
        </div>
        <div class="header-right">
          <!-- Token Badge -->
          <div class="token-badge" *ngIf="isValidUrl() && videoDuration() && videoDuration()! > 0"
            [class.loading]="isLoadingTokens()"
            [matTooltip]="'This is an estimated token count for processing your video. Actual token usage may vary depending on content complexity and processing requirements. This estimate is provided for reference purposes only.'">
            <ng-container *ngIf="!isLoadingTokens(); else loadingTemplate">
              <span class="token-count">{{ tokenCount() | number }} tokens</span>
              <mat-icon class="info-icon">info</mat-icon>
            </ng-container>
            <ng-template #loadingTemplate>
              <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <div class="input-container">
        <mat-form-field appearance="outline" class="input-field">
          <mat-label>YouTube URL</mat-label>
          <input matInput [formControl]="inputControl" placeholder="https://www.youtube.com/watch?v=jNQXAC9IVRw">
          <mat-icon matSuffix *ngIf="isLoadingVideo() && inputControl.valid" class="loading-icon">hourglass_empty</mat-icon>
          <mat-icon matSuffix *ngIf="isValidUrl() && !isLoadingVideo()" class="success-icon">check_circle</mat-icon>
          <mat-error *ngIf="inputControl.invalid && inputControl.touched">
            {{ errorMessage() }}
          </mat-error>
        </mat-form-field>
        <div class="action-buttons">
          <button mat-fab color="primary" class="submit-button" (click)="onSubmit()"
            [disabled]="inputControl.invalid || !videoDuration() || videoDuration()! <= 0 || isSubmitting()"
            matTooltip="Generate Summary" matTooltipClass="consistent-tooltip">
            <mat-icon *ngIf="!isSubmitting()">north</mat-icon>
            <mat-icon *ngIf="isSubmitting()" class="loading-icon">hourglass_empty</mat-icon>
          </button>
          <div class="tune-button-container">
            <button mat-fab class="tune-button" (click)="toggleFineTuning()"
              [disabled]="inputControl.invalid || !videoDuration() || videoDuration()! <= 0"
              [class.active]="isFineTuningExpanded()" matTooltip="Fine Tuning" matTooltipClass="consistent-tooltip">
              <mat-icon>tune</mat-icon>
            </button>
            <div class="red-dot-badge" *ngIf="hasCustomFineTuningConfig() && !isFineTuningExpanded()"></div>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage150()" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ errorMessage150() }}</span>
      </div>
      <!-- Submit Error Message -->
      <div *ngIf="submitError()" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ submitError() }}</span>
      </div>
    </div>

  </div>
</div>